<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>CIMPL 6.0 Language Reference - CIMPL Project</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">CIMPL Project</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../about/">About CIMPL</a>
</li>
                                    
<li >
    <a href="../cimplReleaseNotes/">CIMPL Release Notes</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../cimplInstall/">CIMPL Setup and Installation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../cimpl6Tutorial_helloWorld/">CIMPL 6.0 'Hello World' Tutorial</a>
</li>
                                    
<li >
    <a href="../cimpl6Tutorial_detail/">CIMPL 6.0 In-depth Tutorial</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../cimpl6Authoring/">CIMPL Authoring</a>
</li>
                                    
<li >
    <a href="../cimpl6ObjectiveFHIR/">CIMPL Class Library (aka Objective FHIR)</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference Manuals <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="./">CIMPL 6.0 Language Reference</a>
</li>
                                    
<li >
    <a href="../cimpl6ToolingReference/">CIMPL 6.0 Tooling Reference</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../cimpl6ObjectiveFHIR/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../cimpl6ToolingReference/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#cimpl-60-language-reference">CIMPL 6.0 Language Reference</a></li>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#file-types">File Types</a></li>
            <li><a href="#keywords">Keywords</a></li>
            <li><a href="#cimpl-paths">CIMPL Paths</a></li>
            <li><a href="#constraints">Constraints</a></li>
            <li><a href="#class-file">Class File</a></li>
            <li><a href="#value-set-file">Value Set File</a></li>
            <li><a href="#map-file">Map File</a></li>
            <li><a href="#appendix-a-changes-from-cimpl-5x">Appendix A: Changes from CIMPL 5.x</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="cimpl-60-language-reference">CIMPL 6.0 Language Reference</h1>
<blockquote>
<p><strong>Note:</strong> This documentation is a draft.</p>
</blockquote>
<p><em>This is a comprehensive guide to CIMPL 6.0 syntax.  If you're looking for a quick introduction to CIMPL and SHR-CLI environment setup, try the <a href="../cimpl6Tutorial_helloWorld/">Hello World</a>. If you're looking for a more in-depth introduction, try the <a href="../cimpl6Tutorial_detail/">Tutorial</a>.</em></p>
<hr />
<p><strong>Table of Contents</strong></p>
<div class="toc">
<ul>
<li><a href="#cimpl-60-language-reference">CIMPL 6.0 Language Reference</a><ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#cimpl-versioning">CIMPL Versioning</a></li>
<li><a href="#namespaces">Namespaces</a></li>
</ul>
</li>
<li><a href="#file-types">File Types</a><ul>
<li><a href="#naming-conventions">Naming Conventions</a><ul>
<li><a href="#file-names">File Names</a></li>
<li><a href="#namespace-names">Namespace Names</a></li>
<li><a href="#class-names">Class Names</a></li>
<li><a href="#fully-qualified-names">Fully Qualified Names</a></li>
<li><a href="#value-set-names">Value Set Names</a></li>
<li><a href="#local-code-names">Local Code Names</a></li>
</ul>
</li>
<li><a href="#reserved-words">Reserved Words</a></li>
<li><a href="#whitespace">Whitespace</a></li>
<li><a href="#comments">Comments</a></li>
<li><a href="#primitives">Primitives</a></li>
<li><a href="#concept-codes">Concept Codes</a></li>
</ul>
</li>
<li><a href="#keywords">Keywords</a><ul>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#codesystem">CodeSystem</a></li>
<li><a href="#concept">Concept</a></li>
<li><a href="#description">Description</a></li>
<li><a href="#element">Element</a></li>
<li><a href="#entry">Entry</a></li>
<li><a href="#grammar">Grammar</a></li>
<li><a href="#group">Group</a></li>
<li><a href="#namespace">Namespace</a></li>
<li><a href="#parent">Parent</a></li>
<li><a href="#path">Path</a></li>
<li><a href="#property">Property</a></li>
<li><a href="#uses">Uses</a></li>
<li><a href="#value">Value</a></li>
<li><a href="#valueset">ValueSet</a></li>
</ul>
</li>
<li><a href="#cimpl-paths">CIMPL Paths</a><ul>
<li><a href="#dot-notation">Dot Notation</a></li>
<li><a href="#entries-terminate-paths">Entries Terminate Paths</a></li>
<li><a href="#bracket-notation-for-value-choices">Bracket Notation for Value Choices</a></li>
<li><a href="#path-example">Path Example</a></li>
</ul>
</li>
<li><a href="#constraints">Constraints</a><ul>
<li><a href="#cardinality-constraint">Cardinality Constraint</a></li>
<li><a href="#fixed-value-constraint">Fixed Value Constraint</a></li>
<li><a href="#append-constraint">Append Constraint</a></li>
<li><a href="#substitute-constraint">Substitute Constraint</a></li>
<li><a href="#value-set-binding-constraint">Value Set Binding Constraint</a></li>
<li><a href="#includes-constraint">Includes Constraint</a></li>
<li><a href="#only-constraint">Only Constraint</a></li>
</ul>
</li>
<li><a href="#class-file">Class File</a><ul>
<li><a href="#class-file-example">Class File Example</a></li>
<li><a href="#class-file-header">Class File Header</a></li>
<li><a href="#class-definitions">Class Definitions</a></li>
<li><a href="#class-type-and-name-declaration">Class Type and Name Declaration</a></li>
<li><a href="#properties-and-values">Properties and Values</a></li>
<li><a href="#naming-recommendations">Naming Recommendations</a></li>
</ul>
</li>
<li><a href="#value-set-file">Value Set File</a><ul>
<li><a href="#value-set-file-example">Value Set File Example</a></li>
<li><a href="#value-set-file-header">Value Set File Header</a></li>
<li><a href="#value-set-definition">Value Set Definition</a></li>
<li><a href="#explicit-codes">Explicit Codes</a></li>
<li><a href="#implicit-codes">Implicit Codes</a></li>
</ul>
</li>
<li><a href="#map-file">Map File</a><ul>
<li><a href="#inheritance-of-mapping-rules">Inheritance of Mapping Rules</a></li>
<li><a href="#mapping-cimpl-primitives-to-fhir">Mapping CIMPL Primitives to FHIR</a></li>
<li><a href="#map-file-example">Map File Example</a></li>
<li><a href="#map-file-header">Map File Header</a></li>
<li><a href="#setting-the-mapping-target">Setting the Mapping Target</a></li>
<li><a href="#mapping-properties">Mapping Properties</a></li>
<li><a href="#mapping-to-references">Mapping to References</a></li>
<li><a href="#placement-of-extensions">Placement of Extensions</a></li>
<li><a href="#special-mapping-statements">Special Mapping Statements</a><ul>
<li><a href="#fix">fix</a></li>
<li><a href="#constrain">constrain</a></li>
</ul>
</li>
<li><a href="#slicing">Slicing</a><ul>
<li><a href="#slicing-rules">Slicing Rules</a></li>
<li><a href="#declaring-a-discriminator">Declaring a Discriminator</a></li>
<li><a href="#slice-strategy">Slice Strategy</a></li>
<li><a href="#moving-the-slice-location">Moving the Slice Location</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appendix-a-changes-from-cimpl-5x">Appendix A: Changes from CIMPL 5.x</a></li>
</ul>
</li>
</ul>
</div>
<hr />
<h2 id="overview">Overview</h2>
<p>CIMPL (<strong>C</strong>linical <strong>I</strong>nformation <strong>M</strong>odeling <strong>P</strong>rofiling <strong>L</strong>anguage) is a specially-designed language for defining clinical information models. It is simple and compact, with tools to produce <a href="https://www.hl7.org/fhir/overview.html">Fast Healthcare Interoperability Resources (FHIR)</a> profiles, extensions and implementation guides (IG). Because it is a <em>language</em>, written in text statements, CIMPL encourages distributed, team-based development using conventional source-code control tools such as Github. CIMPL provides tooling that enables you to define a model once, and publish that model to multiple versions of FHIR.</p>
<h3 id="cimpl-versioning">CIMPL Versioning</h3>
<p>CIMPL follows the <a href="https://semver.org">semantic versioning</a> convention (MAJOR.MINOR.PATCH).</p>
<ul>
<li>MAJOR: A major release has significant new functionality and potentially, grammar changes or other non-backward-compatible changes.</li>
<li>MINOR: Contains new or modified features, while maintaining backwards compatability within the major version.</li>
<li>PATCH: Contains minor updates and bug fixes, while maintaining backwards compatability within the major version.</li>
</ul>
<p>CIMPL is currently on major version 6.</p>
<p>For a full change log, see the <a href="https://github.com/standardhealth/shr-cli/releases">Release Notes</a>.</p>
<!-- TODO: Find MAJOR release differences -->

<h3 id="namespaces">Namespaces</h3>
<p>CIMPL organizes information into namespaces. A namespace is conventionally denoted by the authoring organization or project name, and the broad category of elements the namespace defines, delineated by a period. Namespaces must begin with a lowercase character. For example:</p>
<pre><code>Namespace: onco.core
</code></pre>

<blockquote>
<p><strong>Note:</strong> The organization or project name is recommended but not required (e.g., <code>Namespace: lab</code> is also allowed).</p>
</blockquote>
<h2 id="file-types">File Types</h2>
<p>Model information in CIMPL is stored in the following three file types:</p>
<ul>
<li>Class files (.txt): contain definitions of CIMPL classes, which map to FHIR profiles and extensions.</li>
<li>Value Set files (.txt): contain definitions of value sets defined in the namespace.</li>
<li>Map files (.txt): contain information on how the CIMPL models relate to FHIR resources, profiles, and elements.</li>
</ul>
<p>Each namespace will typically have one or more class files, and if needed, a value set and map file.</p>
<h3 id="naming-conventions">Naming Conventions</h3>
<h4 id="file-names">File Names</h4>
<p>File names must begin with lower case and typically include the namespace:</p>
<ul>
<li>Class files: <code>namespace.txt</code> or <code>namespace_something.txt</code></li>
<li>Value Set files: <code>namespace_vs.txt</code> or <code>namespace_something_vs.txt</code></li>
<li>Mapping files: <code>namespace_map.txt</code> or <code>namespace_something_map.txt</code></li>
</ul>
<p>Any periods in the <code>namespace</code> should be replaced by underscores. For example, a namespace called <code>odh.occupation</code>, the recommended value set file name is <code>odh_occupation_vs.txt</code>. The <code>something</code> is useful when you want to break up the contents of a single namespace into multiple files, for example:</p>
<ul>
<li><code>obf_action.txt</code></li>
<li><code>obf_finding.txt</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> <code>obf</code> stands for <em>Objective FHIR</em>, a set of classes provided with CIMPL that can help you create FHIR profiles. For more information, see <a href="../cimpl6ObjectiveFHIR/">Objective FHIR Overview</a></p>
</blockquote>
<p>Additional files for configuring and producing FHIR implementation guides (IGs), and their naming conventions include:</p>
<ul>
<li>Configuration files: <code>ig-igname-config.json</code></li>
<li>Content profile files: <code>ig-igname-cp.json</code></li>
<li>IG examples: <code>ignameExampleName.json</code></li>
<li>IG HTML pages: <code>anyName.html</code></li>
</ul>
<h4 id="namespace-names">Namespace Names</h4>
<p>Best practice is to follow the naming convention pattern of <code>organization.domain</code> or <code>project.domain</code> (followed by subdomains if necessary).</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obf.lab</code></td>
<td>Laboratory profiles belonging to Objective FHIR</td>
</tr>
<tr>
<td><code>odh</code></td>
<td>Occupational Data for Health</td>
</tr>
<tr>
<td><code>onco.core</code></td>
<td>Core namespace for oncology-related profiles</td>
</tr>
</tbody>
</table>
<h4 id="class-names">Class Names</h4>
<p>Elements, Groups and Entries are conventionally defined in <a href="http://wiki.c2.com/?PascalCase">PascalCase</a>. For example:</p>
<pre><code>* Element: DetectionTime
* Group: Dosage
* Entry: AdverseEvent
</code></pre>

<blockquote>
<p><strong>Note:</strong> Letters, numbers, and hyphens are allowed. However, it is required that an element name begins with an uppercase letter.</p>
</blockquote>
<h4 id="fully-qualified-names">Fully Qualified Names</h4>
<p>CIMPL does not support duplicate class names within a single namespace. However, the same name may occur in different namespaces. In the case of naming collisions due to an included namespace in <code>Uses</code>, you have to refer to the class by its fully qualified name (FQN). The FQN is a combination of the element's namespace and its declared name (through concatenation delimited by a period). For example, the element <code>CancerCondition</code> in the namespace <code>onco.core</code> has the following FQN:</p>
<pre><code>onco.core.CancerCondition
</code></pre>

<p>FQNs are only required in case of naming collisions between namespaces.</p>
<h4 id="value-set-names">Value Set Names</h4>
<p>Value Sets are conventionally defined in <a href="http://wiki.c2.com/?PascalCase">PascalCase</a>, with an additional "VS" suffix. For example:</p>
<pre><code>ValueSet: HomeEnvironmentRiskVS
</code></pre>

<blockquote>
<p><strong>Note:</strong> Value Set names must begin with an uppercase letter.</p>
</blockquote>
<h4 id="local-code-names">Local Code Names</h4>
<p>Within a custom value set, the individual codes (denoted by # symbol) are conventionally written in lowercase <a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a>. For example:</p>
<pre><code>ValueSet:          HomeEnvironmentRiskVS
#smoke_detectors   &quot;No Smoke Detectors&quot;
#radiation         &quot;Radon or Other Radiation Source&quot;
#swimming_pool     &quot;Swimming Pool&quot;
</code></pre>

<h3 id="reserved-words">Reserved Words</h3>
<p>CIMPL has a number of reserved words and phrases that are part of CIMPL's grammar (e.g., <code>boolean</code>, <code>or</code>, <code>from</code>, <code>maps to</code>). For a complete list of reserved words, refer to the <a href="https://github.com/standardhealth/shr-grammar/tree/master/src/main/antlr">ANTLR4 grammar</a>.</p>
<h3 id="whitespace">Whitespace</h3>
<p>Repeated whitespace is generally not meaningful within CIMPL files. So this:</p>
<pre><code>Grammar:    DataElement 6.0
Namespace:  myExampleNamespace
</code></pre>

<p>is equivalent to this:</p>
<pre><code>Grammar:        DataElement 6.0

  Namespace:    myExampleNamespace
</code></pre>

<h3 id="comments">Comments</h3>
<p>CIMPL follows <a href="https://www.w3schools.com/js/js_comments.asp">JavaScript syntax</a> for code comments:</p>
<pre><code>// Use a double-slash for comments on a single line

/*
Use slash-asterisk and asterisk-slash for larger block comments.
These comments can take up multiple lines.
*/
</code></pre>

<h3 id="primitives">Primitives</h3>
<p>Primitives are data types, distinguished by starting with lower case letter. CIMPL defines the following primitive data types. With the exception of <code>concept</code> (a simplified representation of code, Coding, and CodeableConcept), the primitive types in CIMPL align with FHIR:</p>
<ul>
<li><a href="#concept-codes">concept</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#boolean">boolean</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#integer">integer</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#string">string</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#decimal">decimal</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#uri">uri</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#base64Binary">base64Binary</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#instant">instant</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#date">date</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#dateTime">dateTime</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#time">time</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#oid">oid</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#id">id</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#markdown">markdown</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#unsignedInt">unsignedInt</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#positiveInt">positiveInt</a></li>
<li><a href="https://www.hl7.org/fhir/datatypes.html#xhtml">xhtml</a></li>
</ul>
<blockquote>
<p><strong>Note:</strong> CIMPL does not have an explicit "Reference" type. References are determined during the mapping process.</p>
</blockquote>
<h3 id="concept-codes">Concept Codes</h3>
<p>CIMPL uses a single primitive type, <code>concept</code> to represent coded terms from controlled vocabularies. A concept combines three elements: code system, code, and optional display text. The grammar for specifying concepts is:</p>
<blockquote>
<p><code>SYSTEM#code "Display text"</code></p>
</blockquote>
<p>For example:</p>
<pre><code>SCT#363346000 &quot;Malignant neoplastic disease (disorder)&quot;
ICD10CM#C004  &quot;Malignant neoplasm of lower lip, inner aspect&quot;
</code></pre>

<p>The SYSTEM is an alias for a canonical URI that represents a controlled vocabulary. Aliases must be declared in the file header using the <a href="#codesystem">CodeSystem keyword</a>. You cannot use the canonical URI directly in the concept grammar.</p>
<p>Unlike FHIR, CIMPL does not differentiate between code, Coding, and CodeableConcept. See <a href="#mapping-concept-codes">Mapping Concept Codes</a> for information on how CIMPL maps <code>concept</code> to these FHIR types.</p>
<blockquote>
<p><strong>Note:</strong> Future versions of CIMPL will expand <code>concept</code> to include the code system version.</p>
</blockquote>
<hr />
<h2 id="keywords">Keywords</h2>
<p>Keywords are used to make various declarations. Keywords always appear at the beginning of a line and are followed by a colon.</p>
<p>Keyword Summary:</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Purpose</th>
<th>File Type(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#abstract">Abstract</a></td>
<td>Declare an non-instantiable class</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#codesystem">CodeSystem</a></td>
<td>Define a code system alias</td>
<td>Class, Value Set</td>
</tr>
<tr>
<td><a href="#concept">Concept</a></td>
<td>Express the meaning of a class</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#description">Description</a></td>
<td>Provide a human-readable description</td>
<td>Class, Value Set</td>
</tr>
<tr>
<td><a href="#element">Element</a></td>
<td>Declare lowest-level (elemental) model building block</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#entry">Entry</a></td>
<td>Declare a stand-alone class</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#grammar">Grammar</a></td>
<td>Define how a file should be parsed</td>
<td>All</td>
</tr>
<tr>
<td><a href="#group">Group</a></td>
<td>Declare mid-level, non-stand-alone model building block</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#namespace">Namespace</a></td>
<td>Associate a file with a namespace</td>
<td>All</td>
</tr>
<tr>
<td><a href="#parent">Parent</a></td>
<td>Specify inheritance</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#path">Path</a></td>
<td>Alias long URLs</td>
<td>Class, Value Set</td>
</tr>
<tr>
<td><a href="#property">Property</a></td>
<td>Define an attribute in a class</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#uses">Uses</a></td>
<td>Import namespace(s)</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#value">Value</a></td>
<td>Define data type(s) of Elements</td>
<td>Class</td>
</tr>
<tr>
<td><a href="#valueset">ValueSet</a></td>
<td>Define a value set</td>
<td>Value Set</td>
</tr>
</tbody>
</table>
<h3 id="abstract">Abstract</h3>
<p>The <code>Abstract</code> keyword is used to declare a new Abstract class. Abstract classes are identical to Entries, except they are not instantiable. For details, see <a href="#class-file">Class File</a>.</p>
<p>Example:</p>
<p><code>Abstract: ActionStatement</code></p>
<h3 id="codesystem">CodeSystem</h3>
<p>The <code>CodeSystem</code> keyword provides an alias or shorthand for the canonical URI of a code system. You <em>must</em> define a code system alias before you can use codes from that system in constraints or value sets. By convention, the alias should be be UPPER CASE, although the tooling does allow for numbers and hyphens after the first upper case letter.</p>
<p>Examples:</p>
<p><code>CodeSystem: LNC = http://loinc.org</code></p>
<p><code>CodeSystem: SCT = http://snomed.info/sct</code></p>
<h3 id="concept">Concept</h3>
<p>The <code>Concept</code> keyword (not to be confused with the <a href="#concept-codes">concept primitive</a>) establishes the meaning of a class in terms of a code (or codes) from controlled vocabularies. Assigning a concept allows the meaning of the class to be understood without inferring it from the class name. If multiple concept codes are used, they should appear as a comma-separated list. This keyword is optional.</p>
<p>Examples:</p>
<p><code>Concept: MTH#C3858779 "Security classification"</code></p>
<h3 id="description">Description</h3>
<p>The <code>Description</code> keyword is used for a narrative that defines the namespace, class, or value set.
<!-- TO DO: Do we support Markdown? -->
Example:</p>
<p><code>Description: "Oncology data elements that broadly apply to most cancer cases."</code></p>
<blockquote>
<p><strong>Note:</strong> While the CIMPL tooling will allow for any pattern of <a href="http://unicode.org/standard/WhatIsUnicode.html">Unicode</a> characters within enclosed double quotation marks (<code>"</code>), certain exporters such as the FHIR exporter will object to non-<a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a> text.)</p>
</blockquote>
<h3 id="element">Element</h3>
<p>The <code>Element</code> keyword is used to declare a new class of type Element, the lowest-level building block in CIMPL. For details, see <a href="#class-file">Class File</a>.</p>
<p>Example:</p>
<p><code>Element: EvidenceType</code></p>
<h3 id="entry">Entry</h3>
<p>The <code>Entry</code> keyword is used to declare a new stand-alone class, analogous to a Resource or Profile in FHIR. For details, see <a href="#class-file">Class File</a>.</p>
<p>Example:</p>
<p><code>Entry: GenomicsReport</code></p>
<h3 id="grammar">Grammar</h3>
<p>The <code>Grammar</code> keyword defines how the file is to be parsed. The grammar declaration must be the first line in each CIMPL file.</p>
<table>
<thead>
<tr>
<th>File Type</th>
<th>Required First Line</th>
<th>Current Version #</th>
</tr>
</thead>
<tbody>
<tr>
<td>Class</td>
<td><code>Grammar: DataElement #.#</code></td>
<td>6.0</td>
</tr>
<tr>
<td>Value Set</td>
<td><code>Grammar: ValueSet #.#</code></td>
<td>5.1</td>
</tr>
<tr>
<td>Map</td>
<td><code>Grammar: Map #.#</code></td>
<td>5.1</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> no space in <code>ValueSet</code></p>
</blockquote>
<p>The version details the MAJOR and MINOR version of the grammar the file was written for. The grammar version is typically <strong>not</strong> the same as the CIMPL release. Generally, the major version of the Grammar matches the major version number of CIMPL, however, <strong>at the time of the CIMPL 6.0 release, the ValueSet and Map grammar remain at 5.1.</strong></p>
<h3 id="group">Group</h3>
<p>The <code>Group</code> keyword is used to declare a building block comprised of one or more properties, similar to a complex data type in FHIR. For details, see <a href="#class-file">Class File</a>.</p>
<p>Example:</p>
<p><code>Group: Dosage</code></p>
<h3 id="namespace">Namespace</h3>
<p>The <code>Namespace</code> keyword defines the association of the file with a namespace, and is required in <code>DataElement</code>, <code>ValueSet</code> and <code>Map</code> files. The namespace can be any number of lowercase period-delimited words.</p>
<p>Examples:</p>
<p><code>Namespace: odh</code></p>
<p><code>Namespace: onco.core</code></p>
<blockquote>
<p><strong>Note:</strong> While it is best practice to use only lower case letters, the strict requirements only require the word to begin with a lowercase letter. The rest of the namespace allows for mixed casing and hyphens.</p>
</blockquote>
<h3 id="parent">Parent</h3>
<p>Through the <code>Parent</code> keyword, CIMPL provides a mechanism for basing a class on another class, the child inheriting all properties and constraints from the parent. The child class can then extend information inherited from the parent by adding additional properties and applying additional constraints. Additionally, mappings are inherited alongside properties. At most one parent class can be specified. The Parent declaration is optional</p>
<p>There are restrictions on which building blocks can inherit from other building blocks. The rules can be summarized as <em>like inherits from like</em>:</p>
<table>
<thead>
<tr>
<th>Building Block</th>
<th>Can Inherit From</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Element</code></td>
<td><code>Element</code></td>
</tr>
<tr>
<td><code>Group</code></td>
<td><code>Group</code></td>
</tr>
<tr>
<td><code>Entry</code></td>
<td><code>Abstract</code> or <code>Entry</code></td>
</tr>
<tr>
<td><code>Abstract</code></td>
<td><code>Abstract</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> Although the CIMPL 6.0 tooling does not currently enforce these inheritance rules, they will be enforced in future releases. You are strongly encouraged to comply to these rules, and refactor any definitions ported from CIMPL 5.x that do not comply.</p>
</blockquote>
<p>Example:</p>
<p><code>Parent: LaboratoryObservation</code></p>
<h3 id="path">Path</h3>
<p>The <code>Path</code> keyword allows for abbreviations of long URLs. This functionality is completely optional, but it is provided to make authoring easier. By convention, the alias should be be an all UPPER CASE word, although the tooling does allow for numbers and hyphens after the first letter.</p>
<p>Example:</p>
<p><code>Path: FHIR = http://hl7.org/fhir/ValueSet</code></p>
<h3 id="property">Property</h3>
<p>Classes based on Group, Entry, and Abstract are composed of one or more properties (called <em>fields</em> or <em>attributes</em> in object-oriented programming). A property can be any Element, Group, or Entry, but never a primitive. Each property must have a specified cardinality range, represented as <code>min..max</code>, indicating the number of repeats of the property. <strong>The Property keyword cannot be used in Elements.</strong></p>
<p>In the following example, StudyArm has four properties: <code>Name</code>, <code>Type</code>, <code>Comment</code> and <code>ResearchStudy</code>. <code>Name</code> is singular and required, <code>Type</code> is optional and repeating, and <code>Comment</code> is singular and optional:</p>
<pre><code>Group:             StudyArm
Description:       &quot;Refers to participant(s) in a clinical trial assigned to receive specific interventions according to a protocol.&quot;
Property:          Name 1..1
Property:          Type 0..*
Property:          Comment 0..1
Property:          ResearchStudy 1..1
</code></pre>

<p>A property that refers to an Entry (such as ResearchStudy, above) is implicitly a reference (pointer) to an instance of that Entry, rather than implying the Entry is "in-lined" into the class.</p>
<blockquote>
<p><strong>Note:</strong> CIMPL 5.0 Grammar use of the keyword <code>ref()</code> is now obsolete.</p>
</blockquote>
<h3 id="uses">Uses</h3>
<p>The <code>Uses</code> keyword appears in the Class file and provides a comma-separated list of the namespaces imported to the current namespace. This keyword allows you to use the classes and value sets defined in other namespaces. The list order has no effect.</p>
<p>Examples:</p>
<p><code>Uses: obf.datatype</code></p>
<p><code>Uses: obf.datatype, obf, onco.core</code></p>
<!-- TODO: VERIFY THIS: In CIMPL version 6, it is *required* that you import `shr.core` for the tooling to run.-->

<h3 id="value">Value</h3>
<p><code>Value</code> represents the data type(s) an Element can accept. This keyword can only be used when defining an Element. Each Element must have exactly one <code>Value</code>, although the value itself can be a choice of several data types. Value choices can be <a href="#primitives">Primitives</a>, <a href="#element">Elements</a>, <a href="#group">Groups</a>, or <a href="#entry">Entries</a>. A value may be inherited and constrained in the child class.</p>
<p>Examples:</p>
<pre><code>Element:           DetectionTime
Description:       &quot;The date on which the condition was first observed.&quot;
Value:             dateTime
</code></pre>

<pre><code>Element:           ExpectedPerformanceTime
Description:       &quot;When an action should be performed.&quot;
Value:             dateTime or TimePeriod or Timing
</code></pre>

<pre><code>Element:           SubstanceOrCode
Description:       &quot;A code or substance reference identifying the ingredient.&quot;
Value:             concept or Substance or Medication
</code></pre>

<p>Although in general, constraints cannot be applied to a property or value at the same time the item is defined, you are allowed to bind a value set to a <code>concept</code> value choice at the same time the value is defined, as follows:</p>
<pre><code>Element:           IsPrimaryTumor
Description:       &quot;Whether the tumor is the original or first tumor in the body, for a particular cancer.&quot;
Value:             concept from YesNoUnknownVS (required)
</code></pre>

<p>For more information on binding, see <a href="#value-set-binding-constraint">Value Set Binding Constraint</a>.</p>
<blockquote>
<p><strong>Note:</strong> CIMPL 5.0 Grammar associating a cardinality to a Value is now obsolete.</p>
</blockquote>
<h3 id="valueset">ValueSet</h3>
<p>Defines the name of a value set defined inside CIMPL (references to external value sets are also allowed). By convention, all value sets should be Pascal case, start with the name of the corresponding concept-type Element that is being bound to the value set, and end with <code>VS</code>.</p>
<p>Example:</p>
<p><code>ValueSet: ProposedStatusVS</code></p>
<hr />
<h2 id="cimpl-paths">CIMPL Paths</h2>
<p>CIMPL provides grammar that allows you to refer to any part of a CIMPL class, regardless of nesting. This section outlines CIMPL Path Grammar, which is used in <a href="#constraints">constraints</a> and <a href="#map-file">mapping</a>.</p>
<h3 id="dot-notation">Dot Notation</h3>
<p>Dot notation is used to denote nested properties. The path lists the properties in order, separated by a dot (.) For example, if <code>Patient</code> has a <code>ContactPoint</code>, and <code>ContactPoint</code> has a <code>Priority</code>, then the path to <code>Priority</code> is <code>Patient.ContactPoint.Priority</code>.</p>
<h3 id="entries-terminate-paths">Entries Terminate Paths</h3>
<p>An Entry can appear in a path only as its final element. Paths represent nested containment within one class, and Entries are independent objects. Paths cannot "hop" from one Entry to another.</p>
<p>For example,  <code>Procedure</code> has a <code>Patient</code> property, and while <code>Procedure.Patient</code> is a valid path, <code>Procedure.Patient.gender</code> is not. The former path can be used to set the cardinality of <code>Patient</code> within the <code>Procedure</code> class, but the latter would (illegally) constrain an attribute within <code>Patient</code> from inside  <code>Procedure</code>.</p>
<h3 id="bracket-notation-for-value-choices">Bracket Notation for Value Choices</h3>
<p>Values can offer a <a href="#value">choice of data types</a>. Bracket notation is used to refer to a particular value choice. Bracket notation must always be used when an Element is part of a CIMPL path. How value choices appear in paths depends on whether the path appears with an Element definition or not.</p>
<table>
<thead>
<tr>
<th>Inside an:</th>
<th>Refer to the Value choices as:</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Element</code></td>
<td><code>Value[choice]</code></td>
</tr>
<tr>
<td><code>Entry</code> or <code>Group</code></td>
<td><code>ElementName[choice]</code></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre><code>Entry: Procedure
Property: Priority 0..1
Priority[concept] = SCT#394849002 &quot;High Priority&quot; // not Value[concept]

Element: Priority
Value: integer or concept
Value[concept] from PriorityVS (required)  // not Priority[concept]


</code></pre>

<blockquote>
<p><strong>Note:</strong> The requirement in CIMPL 6.0 to use bracket notation <em>even when the value has only one choice</em> is a change from CIMPL 5.</p>
</blockquote>
<h3 id="path-example">Path Example</h3>
<pre><code>Group:             Landmark
Description:       &quot;A point on the body that helps determine a body location.&quot;
Property:          Location 0..1
Property:          Direction 0..1
Property:          Distance 0..1

Group:             Location
Description:       &quot;Location of the landmark&quot;
Property:          Code 0..1
Property:          Laterality 0..1
Property:          Orientation 0..1

Element:           Distance
Description:       &quot;How far the body location of interest is from the given landmark.&quot;
Value:             Quantity

Element:           Direction
Description:       &quot;The direction from the landmark to the body location of interest.&quot;
Value:             ClockFaceDirection or AnatomicalDirection

Element:           ClockFaceDirection
Description:       &quot;A direction indicated by o'clock position or degrees relative to 12 o'clock.&quot;
Value:             concept or Angle

Group:             Quantity
Description:       &quot;A quantity with units.&quot;
Property:          Number 0..1
Property:          Comparator 0..1
Property:          Units 0..1

</code></pre>

<p>This example assumes all paths begin at Landmark.</p>
<table>
<thead>
<tr>
<th>Path to</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>Direction</td>
<td>Landmark.Direction</td>
</tr>
<tr>
<td>Laterality</td>
<td>Landmark.Location.Laterality</td>
</tr>
<tr>
<td>ClockFaceDirection</td>
<td>Landmark.Direction[ClockFaceDirection]</td>
</tr>
<tr>
<td>Angle</td>
<td>Landmark.Direction[ClockFaceDirection][Angle]</td>
</tr>
<tr>
<td>Units</td>
<td>Landmark.Distance[Quantity].Units</td>
</tr>
</tbody>
</table>
<p>A reliable method to create a CIMPL path is to first view it as a dot path, then bracket any part of the path that is a Value, and finally, remove the dot before each left (open) bracket. Here's an example of that process, for the path from Landmark to Units:</p>
<ol>
<li>Find the path: <code>Landmark</code> to <code>Distance</code>, <code>Distance</code> to <code>Quantity</code>, <code>Quantity</code> to <code>Units</code>.</li>
<li>Reduce to dot path: <code>Landmark.Distance.Quantity.Units</code></li>
<li>Bracket each Value: <code>Landmark.Distance.[Quantity].Units</code></li>
<li>Remove dot before left (open) bracket: <code>Landmark.Distance[Quantity].Units</code></li>
</ol>
<hr />
<h2 id="constraints">Constraints</h2>
<p>Constraints are a way to shape a general model for a particular purpose. Properties, values, and value choices can be constrained. Constraint targets can be be top-level or deeply nested (the latter referred to using <a href="#cimpl-paths">CIMPL paths</a>), inherited or locally-defined.</p>
<p>Unlike keyword declarations, constraint statements do not begin with a keyword. Most constraint statements have three parts:</p>
<ul>
<li>The subject of the constraint</li>
<li>A reserved word or phrase indicating the type of constraint</li>
<li>The constraint value being applied</li>
</ul>
<p>Here are several examples of this pattern:</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Subject</th>
<th>Reserved word</th>
<th>Value applied</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IsPrimaryTumor = true</code></td>
<td><code>IsPrimaryTumor</code></td>
<td><code>=</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>Specimen substitute TumorSpecimen</code></td>
<td><code>Specimen</code></td>
<td><code>substitute</code></td>
<td><code>TumorSpecimen</code></td>
</tr>
<tr>
<td><code>BodyLocation from BodyLocationVS</code></td>
<td><code>BodyLocation</code></td>
<td><code>from</code></td>
<td><code>BodyLocationVS</code></td>
</tr>
<tr>
<td><code>LanguageUsed 0..1</code></td>
<td><code>LanguageUsed</code></td>
<td><em>(implicit)</em></td>
<td><code>0..1</code></td>
</tr>
</tbody>
</table>
<p>Here is a summary of constraints supported in CIMPL 6:</p>
<table>
<thead>
<tr>
<th>To do this..</th>
<th>Use this Keyword or Symbol</th>
<th>Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#cardinality-constraint">Narrow cardinality</a></td>
<td><code>{min}..{max}</code></td>
<td>Property</td>
</tr>
<tr>
<td><a href="#fixed-value-constraint">Assign a fixed value</a></td>
<td><code>=</code></td>
<td>Property or Value[Choice]</td>
</tr>
<tr>
<td><a href="#append-constraint">Append a fixed value to an array</a></td>
<td><code>+=</code></td>
<td>Array Property</td>
</tr>
<tr>
<td><a href="#substitute-constraint">Narrow a data type</a></td>
<td><code>substitute</code></td>
<td>Property or Value[Choice]</td>
</tr>
<tr>
<td><a href="#value-set-binding-constraint">Bind a value set</a></td>
<td><code>from</code></td>
<td>Property or Value[Choice]</td>
</tr>
<tr>
<td><a href="#includes-constraint">Slice an array</a></td>
<td><code>includes</code></td>
<td>Array Property</td>
</tr>
<tr>
<td><a href="#only-constraint">Narrow choices for a value</a></td>
<td><code>only</code></td>
<td>Value</td>
</tr>
</tbody>
</table>
<h3 id="cardinality-constraint">Cardinality Constraint</h3>
<p>Cardinality defines the number of repeats that can exist for a property. Cardinality is specified using FHIR syntax, {min}..{max}, where the first integer indicates the minimum repeats (0 implying optional), and the second digit expresses the upper bound on the number of repeats. To express no upper bound, a <code>*</code> is used. When constraining cardinality, you can only narrow the previously declared cardinality. The cardinality constraint only applies to properties.</p>
<table>
<thead>
<tr>
<th>Declaration</th>
<th>Constraint</th>
<th>Subsequent Constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Property: LanguageUsed 0..*</code></td>
<td><code>LanguageUsed  0..1</code></td>
<td><code>LanguageUsed  0..0</code></td>
</tr>
<tr>
<td><code>Property: GovernmentIssuedID  0..*</code></td>
<td><code>GovernmentIssuedID 1..*</code></td>
<td><code>GovernmentIssuedID 1..1</code></td>
</tr>
<tr>
<td><code>Property: Status 1..1</code></td>
<td><del><code>Status 0..1</code></del> invalid</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> By constraining a property to 0..0, you effectively remove the property. Use 0..0 with caution, because if an instance <em>does</em> include that property, the instance will fail validation and may be rejected.</p>
</blockquote>
<h3 id="fixed-value-constraint">Fixed Value Constraint</h3>
<p>The <code>=</code> operator fixes a property to a specific value (e.g., a specific concept, boolean, string, integer, decimal, or URL). The assigned value must be consistent with the defined data type, and is always a primitive. Fixed value constraints apply to properties and value choices.</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fix a code to a property</td>
<td><code>ObservationCode = LNC#82810-3</code></td>
</tr>
<tr>
<td>Fix a boolean value to a property</td>
<td><code>IsPrimaryTumor = true</code></td>
</tr>
<tr>
<td>Fix a code to a value choice</td>
<td><code>Value[concept] = SCT#233613009 "Pneumonia"</code></td>
</tr>
<tr>
<td>Fix the units associated with a Quantity value choice</td>
<td><code>Value[Quantity].Units = UCUM#cm</code></td>
</tr>
<tr>
<td>Fix a code to a value</td>
<td><del><code>Value = SCT#233613009 "Pneumonia"</code></del> invalid</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Notes:</strong></p>
<ol>
<li><a href="#bracket-notation-for-value-choices">Bracket notation</a> must always be used when applying a constraint to a value choice, <em>even if the value has only one choice</em>. This is a change from CIMPL 5.</li>
<li>CIMPL allows fixed concept values to be overridden in child classes. Although this seems to violate the notion that constraints should get progressively tighter in subclasses, it is necessary when narrowing the meaning of a class characterized by a concept code. For example, the class <code>Pneumonia</code>, with fixed code, <code>SCT#233604007</code>, may have a child, <code>Fungal Pneumonia</code>, with fixed code <code>SCT#233613009</code>, the latter overriding the former. CIMPL will assume, without checking, that the code describing the child class has more constrained semantics than the code it replaces.</li>
<li>Fixing numerical types and strings (including URLs) is not yet supported, although this feature is planned.</li>
<li>If you only need to fix a value code for one particular mapping (one version of FHIR, for example), do so using the <a href="#fix"><code>fix</code></a> keyword in the mapping file.</li>
</ol>
</blockquote>
<h3 id="append-constraint">Append Constraint</h3>
<p>The append (<code>+=</code>) operator appends a fixed concept to a property array whose value is <code>concept</code>. You can use the <code>+=</code> operation repeatedly on the same array, limited only be the cardinality of the array. The append operator can only be applied to repeating properties.</p>
<p>For example, you would use <code>+=</code> to insert a particular Social Security Number (SSN) or Driver's License number into an array of identifiers (in contrast, <a href="#includes-constraint"><code>includes</code></a> would be used to require the array contain one or more SSNs, without specifying a particular SSN.)</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert "Behavior" into Category array</td>
<td><code>Category += LNC#54511-1 "Behavior"</code></td>
</tr>
<tr>
<td>Add "Social History" to same array</td>
<td><code>Category += OBSCAT#social-history "Social History"</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> Appending other primitive types is not yet supported, although this feature is planned.</p>
</blockquote>
<h3 id="substitute-constraint">Substitute Constraint</h3>
<p>The <code>substitute</code> keyword constrains the data type of a property. The new data type that is substituted for the original must be a subclass of the original data type.</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>Constrain the property <code>Specimen</code> to be a <code>TumorSpecimen</code></td>
<td><code>Specimen substitute TumorSpecimen</code> <br/> <em>note: TumorSpecimen must be a subclass of Specimen</em></td>
</tr>
<tr>
<td>Constrain a value choice of type <code>Quantity</code> to <code>SimpleQuantity</code></td>
<td><code>Value[Quantity] substitute SimpleQuantity</code> <br/> <em>note: SimpleQuantity is a subclass of Quantity</em></td>
</tr>
</tbody>
</table>
<h3 id="value-set-binding-constraint">Value Set Binding Constraint</h3>
<p>Binding is the process of associating a concept with a set of possible values. Binding uses the keyword <code>from</code>. The object of a binding must be an Element whose value is a concept. The value set that is being bound can be a value set defined in CIMPL or a canonical URL external to CIMPL.</p>
<p>CIMPL uses the same <a href="https://www.hl7.org/fhir/valueset-binding-strength.html">binding strengths as FHIR</a>, namely:</p>
<ul>
<li><code>required</code> (strongest) indicates that the code must come from the specified value set.</li>
<li><code>extensible</code> indicates that the code must come from the specified set <em>if the value set contains a relevant code</em>; otherwise a code outside the value set may be chosen.</li>
<li><code>preferred</code> indicates that the code should ideally come from the specified value set, but codes outside the value set may also be chosen.</li>
<li><code>example</code> (weakest) indicates that the code may come from anywhere; the specified value set is for example purposes only.</li>
</ul>
<p>The following rules apply to binding in CIMPL 6:</p>
<ul>
<li>If no binding strength is specified, the binding is assumed to be <code>required</code>.</li>
<li>When further constraining an existing binding, the binding strength can stay the same or be made tighter (e.g., replacing an <code>preferred</code> binding with an <code>extensible</code> or <code>required</code> binding), but never loosened.</li>
<li>Constraining may leave the binding strength the same and change the value set instead. However, certain changes permitted in CIMPL may violate <a href="http://hl7.org/fhir/R4/profiling.html#binding-strength">FHIR profiling principles</a>. In particular, FHIR will permit a required value set to be replaced by another required value set only if the codes in the new value set are a subset of the codes in the original value set. For extensible bindings, the new value set can contain codes not in the existing value set, but additional codes SHOULD NOT have the same meaning as existing codes in the base value set.</li>
</ul>
<table>
<thead>
<tr>
<th>Example</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>Required binding of a Property (property is an Element with <code>concept</code> data type)</td>
<td><code>ClinicalStatus from http://hl7.org/fhir/ValueSet/condition-clinical (required)</code></td>
</tr>
<tr>
<td>Required binding of a Property (by default)</td>
<td><code>ClinicalStatus from http://hl7.org/fhir/ValueSet/condition-clinical</code></td>
</tr>
<tr>
<td>Extensible binding of a Property</td>
<td><code>ReasonCode from ReasonCodeVS (extensible)</code></td>
</tr>
<tr>
<td>Preferred binding of a Property</td>
<td><code>BodyLocation from BodyLocationVS (preferred)</code></td>
</tr>
<tr>
<td>Required binding of a Value Choice that is a concept</td>
<td><code>Value[concept] from http://hl7.org/fhir/ValueSet/condition-clinical (required)</code></td>
</tr>
<tr>
<td>Required binding of a Value Choice that is an Element whose value is a concept</td>
<td><code>Value[ClinicalStatus] from http://hl7.org/fhir/ValueSet/condition-clinical (required)</code></td>
</tr>
</tbody>
</table>
<h3 id="includes-constraint">Includes Constraint</h3>
<p>The <code>includes</code> constraint is used to specify that a repeating property (array) should contain a certain class or classes. FHIR refers to this as <a href="https://www.hl7.org/fhir/profiling.html#slicing">slicing</a>. In CIMPL, it is a simple matter of saying an array <code>includes</code> certain types of elements.</p>
<p>The <code>includes</code> statement has several requirements:</p>
<ul>
<li>The elements included in the array must conform to the data type of the array. For example, if the array is <code>Identifier 0..*</code>, the items included in the array must inherit from Identifier.</li>
<li>Cardinality of each inclusion must be specified, and must fit the cardinality of the array. For example, if the array property has a finite maximum cardinality, you cannot include an element with cardinality 0..*.</li>
<li>The keyword <code>includes</code> is repeated for each item the array should contain.</li>
<li>The <code>includes</code> constraint does not apply to Values.</li>
</ul>
<p>Here is an example:</p>
<pre><code>Property: Measurement 0..*  // the array property
...
Measurement includes TumorLength 1..1 includes TumorWidth 0..1 includes TumorDepth 0..1

</code></pre>

<p>TumorLength, TumorWidth, and TumorDepth all must inherit from Measurement, because Measurement is the array property being sliced. Optionally, the second statement can be written on separate lines (since CIMPL is whitespace insensitive):</p>
<pre><code>Measurement
includes TumorLength 1..1
includes TumorWidth 0..1
includes TumorDepth 0..1
</code></pre>

<p>Here is another example:</p>
<pre><code>Property: Identifier 1..*  // the array property
...
Identifier
includes NationalProviderIdentifier 0..1
includes TaxIdentificationNumber 0..1
</code></pre>

<!--
  CM: The statement below is not true in the current form of the language.  We treat includes as "open", meaning that the includes do not close the set of possible values.
  In other words, we currently would allow other identifiers aside from NPI and TaxID, so it's not true that one of them must be present.
  If this is not the intent, we should discuss and will have to modify how we render slices based on includes constraints.
-->

<p>In this case, either NationalProviderIdentifier or TaxIdentificationNumber must be present, even though both are individually optional, because of the 1..* cardinality on Identifier.</p>
<blockquote>
<p><strong>Note:</strong> When using <code>includes</code>, special mapping syntax is required. See <a href="#slicing">Slicing</a>.</p>
</blockquote>
<h3 id="only-constraint">Only Constraint</h3>
<p>Values can have multiple data types. Use the <code>only</code> constraint in an Element to narrow the choice of data types. The <code>only</code> constraint can only be applied to a Value that has multiple choices. The grammar of <code>only</code> constraints varies depending on whether the constraint appears in an Element, or another type of Class.</p>
<p>Example:</p>
<pre><code>Element: Priority
Value: integer or concept
</code></pre>

<table>
<thead>
<tr>
<th>Inside Class...</th>
<th>Grammar</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Element</code></td>
<td><code>Value only integer</code></td>
</tr>
<tr>
<td><code>Entry</code> or <code>Group</code></td>
<td><code>Priority only integer</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> CIMPL currently does not support narrowing a choice to a more limited choice, for example, narrowing a choice of three types to two types. This feature is planned.</p>
</blockquote>
<hr />
<h2 id="class-file">Class File</h2>
<p>Class files contain definitions of the information model.</p>
<h3 id="class-file-example">Class File Example</h3>
<p>Here is an abbreviated example of a class file:</p>
<pre><code>Grammar:           DataElement 6.0
Namespace:         obf.lab
Description:       &quot;Profiles of laboratory tests and panels.&quot;
Uses:              datatype, obf
CodeSystem:        LNC = http://loinc.org
CodeSystem:        UCUM = http://unitsofmeasure.org

Abstract:          SimpleQuantLabWithRequiredUnits
Parent:            SimpleQuantitativeLaboratoryObservation
Description:       &quot;Laboratory tests that must be reported with units.&quot;
                   DataValue 1..1
                   DataValue only QuantityWithRequiredUnits
                   DataAbsentReason 0..0

Group:             QuantityWithRequiredUnits
Parent:            Quantity
Description:       &quot;A quantity with that requires a coded unit of measure.&quot;
                   Units 1..1

Entry:             GlobulinMCncPtSerQnCalculatedLabObs
Parent:            SimpleQuantLabWithRequiredUnits
Description:       &quot;Globulin [Mass/​volume] in Serum by calculation&quot;
                   Code = LNC#10834-0 &quot;Globulin [Mass/​volume] in Serum by calculation&quot;
                   DataValue[Quantity].Units from EquivalentUnitsVS-g-per-L (required)

</code></pre>

<!--
    CM: Note that the value set above (EquivalentUnitsVS-g-per-L) violates the naming convention this reference guide encourages.  I left it as-is since this is how the
    current CIMPL source really is, but we should consider changing to EquivalentUnits-g-per-L-VS (or something like that).
-->

<h3 id="class-file-header">Class File Header</h3>
<p>The elements of the class file header are (in order):</p>
<ol>
<li><code>Grammar</code> (required)</li>
<li><code>Namespace</code> (required)</li>
<li><code>Description</code> (recommended; once per namespace)</li>
<li><code>Uses</code> (optional; as needed)</li>
<li><code>CodeSystem</code> (optional; as needed)</li>
<li><code>Path</code> (optional)</li>
</ol>
<p>For a further description, see <a href="#keywords">Keywords</a>.</p>
<blockquote>
<p><strong>Note:</strong> <code>Uses</code> imports namespaces whose classes can be used as if they were locally defined. However, if a class name in an imported namespace collides with a local class name, you must refer to that element by its <a href="#fully-qualified-names">fully qualified name</a>.</p>
</blockquote>
<h3 id="class-definitions">Class Definitions</h3>
<p>Following the header, the class file contains a number of class definitions. The order of definitions does not matter. Each class definition has contains declarations. The first declaration must be Class type and Name. Subsequent declarations can be in any order. Follow the links for further explanation of each item:</p>
<ol>
<li><a href="#class-type-and-name-declaration">Class Type and Name Declaration</a> (required)</li>
<li><a href="#parent">Parent Declaration</a> (optional)</li>
<li><a href="#concept">Concept Declaration</a> (optional)</li>
<li><a href="#description">Description</a> (optional but highly recommended)</li>
<li><a href="#property">Property Declarations</a> (for Entry, Abstract and Group) or <a href="#value">Value Declaration</a> (for Element) (optional, but typically present)</li>
<li><a href="#constraints">Constraint statements</a> (optional)</li>
</ol>
<h3 id="class-type-and-name-declaration">Class Type and Name Declaration</h3>
<p>The first line of all class definitions is a keyword representing the type of building block, followed by a descriptive name you choose. Class names must be unique within a given namespace. CIMPL provides four types of building blocks:</p>
<table>
<thead>
<tr>
<th>Building Block</th>
<th>Description</th>
<th>Has...</th>
<th>Analogous FHIR Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Element</code></td>
<td>The lowest-level building block, representing a property-value pair.</td>
<td>Value</td>
<td>Property or simple extension</td>
</tr>
<tr>
<td><code>Group</code></td>
<td>A building block comprised of other building blocks, specifically, other Groups, Elements, and Entries.</td>
<td>Properties</td>
<td>Backbone element or complex extension</td>
</tr>
<tr>
<td><code>Entry</code></td>
<td>A building block representing a group of related information, complete enough to support stand-alone interpretation.</td>
<td>Properties</td>
<td>Resource or Profile</td>
</tr>
<tr>
<td><code>Abstract</code></td>
<td>A special type of Entry that cannot be instantiated, and will not be present in the target mapping.</td>
<td>Properties</td>
<td>none</td>
</tr>
</tbody>
</table>
<h3 id="properties-and-values">Properties and Values</h3>
<p>When defining classes, bear in mind that an <code>Element</code> has exactly one <code>Value</code> field and no <code>Property</code> fields, whereas, a <code>Group</code>, <code>Entry</code>, or <code>Abstract</code> can have multiple <code>Property</code> fields but cannot have a <code>Value</code> field. Furthermore, a <code>Property</code> cannot have choices, but a <code>Value</code> can.</p>
<p>These differences are illustrated in this example:</p>
<pre><code>Element:           ExpectedPerformanceTime
Description:       &quot;When an action should be performed.&quot;
Value:             dateTime or TimePeriod or Timing
</code></pre>

<pre><code>Group:             Landmark
Description:       &quot;A point on the body that helps determine a body location.&quot;
Property:          Location 0..1
Property:          Direction 0..1
Property:          Distance 0..1
</code></pre>

<p>Summary:</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Appears in</th>
<th>How Many Times?</th>
<th>Has Cardinality?</th>
<th>Has Choices?</th>
<th>Can be a...</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Value</code></td>
<td><code>Element</code></td>
<td>Exactly Once</td>
<td>No</td>
<td>Yes (optionally)</td>
<td>primitive, Element, Group, or Entry</td>
</tr>
<tr>
<td><code>Property</code></td>
<td><code>Group</code>, <code>Entry</code>, or <code>Abstract</code></td>
<td>Zero or more</td>
<td>Yes</td>
<td>No</td>
<td>Element, Group, or Entry</td>
</tr>
</tbody>
</table>
<h3 id="naming-recommendations">Naming Recommendations</h3>
<p>All classes in CIMPL, from Elements to Entries, are reusable outside of their original context. To promote reuse, try to choose names that are self-explanatory and context-independent. For example, a property named <code>Text</code> is too vague, whereas <code>DisplayText</code> and <code>InstructionText</code> are more self-explanatory and may be completely understandable when placed into a specific context. However, an overly-specific name like <code>AddressDisplayText</code> could inhibit reuse because it affixes the <em>context</em> of an address to the <em>concept</em> of a display text.</p>
<hr />
<h2 id="value-set-file">Value Set File</h2>
<p>The value set files are used to define custom value sets and codes when existing value set sources like <a href="https://www.hl7.org/fhir/terminologies-v3.html">HL7 v3</a>, <a href="https://www.hl7.org/fhir/terminologies-systems.html">FHIR</a>, <a href="https://vsac.nlm.nih.gov/">VSAC</a>, or <a href="https://phinvads.cdc.gov/">PHIN VADS</a> are insufficient, and a new value set must be defined.</p>
<h3 id="value-set-file-example">Value Set File Example</h3>
<p>A (truncated) example value set file is shown below:</p>
<pre><code>Grammar:      ValueSet 5.1
Namespace:    onco.core
CodeSystem:   SCT = http://snomed.info/sct
CodeSystem:   ICD10CM = http://hl7.org/fhir/sid/icd-10-cm

ValueSet:     CancerDiseaseStatusEvidenceTypeVS
Description:  &quot;The type of evidence backing up the clinical determination of cancer progression.&quot;
SCT#363679005 &quot;Imaging (procedure)&quot;
SCT#252416005 &quot;Histopathology test (procedure)&quot;
SCT#711015009 &quot;Assessment of symptom control (procedure)&quot;
SCT#5880005   &quot;Physical examination procedure (procedure)&quot;
SCT#250724005 &quot;Tumor marker measurement (procedure)&quot;
SCT#386344002 &quot;Laboratory data interpretation (procedure)&quot;

ValueSet:      SecondaryCancerDisorderVS
Description:  &quot;Types of secondary malignant neoplastic disease&quot;
Includes codes descending from SCT#128462008  &quot;Secondary malignant neoplastic disease (disorder)&quot;
ICD10CM#C7B00  &quot;Secondary carcinoid tumors, unspecified site&quot;
ICD10CM#C7B01  &quot;Secondary carcinoid tumors of distant lymph nodes&quot;
ICD10CM#C7B02  &quot;Secondary carcinoid tumors of liver&quot;
ICD10CM#C7B03  &quot;Secondary carcinoid tumors of bone&quot;
ICD10CM#C7B04  &quot;Secondary carcinoid tumors of peritoneum&quot;
</code></pre>

<h3 id="value-set-file-header">Value Set File Header</h3>
<p><code>Grammar</code> and <code>Namespace</code> are required keywords in a Value Set file header. One or more <code>CodeSystem</code> will be needed. For a further description, see <a href="#keywords">Keywords</a>.</p>
<h3 id="value-set-definition">Value Set Definition</h3>
<p>Following the header, the Value Set file contains a number of value set definitions. The order of definitions does not matter. Each definition follows a set sequence of declarations. Follow the links for further explanation of each item:</p>
<ol>
<li><a href="#ValueSet">Value Set Declaration</a> (required)</li>
<li><a href="#description">Description</a> (optional but highly recommended)</li>
<li><a href="#code-declaration">Code Declarations</a> (optional)</li>
<li><a href="#includes-codes">Includes Codes statements</a> (optional)</li>
</ol>
<h3 id="explicit-codes">Explicit Codes</h3>
<p>Explicit code declarations are used to add specific codes to a value set. Codes can either be locally-defined, or selected from external code systems, such as the <code>CAP#29915</code> example, in which <code>29915</code> is an existing code within the <code>CAP</code> code system. If the code is defined locally, the value set name serves as the code system. For the syntax of concept codes, see <a href="#concept-codes">Concept Codes</a>.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Locally-defined code</td>
<td><code>#proposed "The proposal has been proposed, but not accepted or rejected."</code></td>
</tr>
<tr>
<td>Externally-defined code</td>
<td><code>CAP#29915 "None/Negative"</code></td>
</tr>
</tbody>
</table>
<h3 id="implicit-codes">Implicit Codes</h3>
<p>Implicit code declarations are used to add sets of codes to a value set, in particular, from hierarchically-defined code systems. At present, the only hierarchical system supported is SNOMED-CT. There are three variants involving the <code>Includes codes</code> phrase:</p>
<table>
<thead>
<tr>
<th>Phrase</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Includes codes from</code></td>
<td><code>Includes codes from MDR</code></td>
<td>Value set contains all codes from MDR code system</td>
</tr>
<tr>
<td><code>Includes codes descending from</code></td>
<td><code>Includes codes descending from SCT#105590001</code></td>
<td>Value set contains SCT#1055900001 and all codes below it in the SNOMED-CT hierarchy</td>
</tr>
<tr>
<td><code>and not descending from</code></td>
<td><code>Includes codes descending from SCT#363346000 "Malignant neoplastic disease" and not descending from SCT#128462008  "Secondary malignant neoplastic disease"</code></td>
<td>Value set contains SCT#363346000 and all codes below it in the SNOMED-CT hierarchy, <em>except</em> code SCT#128462008 and all codes below it</td>
</tr>
</tbody>
</table>
<h2 id="map-file">Map File</h2>
<p>Map files control how classes defined in CIMPL are expressed as FHIR profiles. Map files are FHIR-version dependent. Currently, you can map to FHIR DSTU 2, STU 3, R4. If you use the supplied <a href="../cimpl6ObjectiveFHIR/">Objective FHIR base classes</a>, you many not need to create a map file.</p>
<h3 id="inheritance-of-mapping-rules">Inheritance of Mapping Rules</h3>
<p>Maps are defined in a series of mapping rules. A powerful feature of CIMPL is that mapping rules are inherited. If your class inherits from a parent class that already is mapped, you do not need to create a new map for your class. However, if you you want specify mappings for new properties, or override the inherited map, you may do so.</p>
<p>The inheritance of mapping rules follows the class hierarchy. If there is no map for a class or attribute, CIMPL tooling automatically looks to the parent class to try and find a mapping. The first mapping rule found will be applied. If no mapping rule is found for a <code>Property</code> defined in CIMPL, a FHIR extension will be created. If no mapping is found for an <code>Entry</code>, that <code>Entry</code> will be mapped to the <a href="https://www.hl7.org/fhir/basic.html">Basic resource</a>. In general, mapping to Basic is not recommended because it has no inherent semantic meaning for implementers. </p>
<h3 id="mapping-cimpl-primitives-to-fhir">Mapping CIMPL Primitives to FHIR</h3>
<p>CIMPL follows somewhat flexible rules on how CIMPL primitives map to FHIR. For example, a unsignedInt in CIMPL can map to an integer type in FHIR (since every unsignedInt is an integer, there is no loss of information). However, mappings that lose information, such as integer in CIMPL to unsignedInt in FHIR, generally will trigger mapping errors. An exception is that CIMPL <code>concept</code> is allowed to map to FHIR <code>code</code>. The following table shows the acceptable mappings between CIMPL and FHIR:</p>
<table>
<thead>
<tr>
<th>CIMPL Primitive</th>
<th>Can map to FHIR...</th>
</tr>
</thead>
<tbody>
<tr>
<td>concept</td>
<td>code, Coding, CodableConcept</td>
</tr>
<tr>
<td>boolean</td>
<td>boolean, code</td>
</tr>
<tr>
<td>integer</td>
<td>integer, Quantity</td>
</tr>
<tr>
<td>string</td>
<td>string</td>
</tr>
<tr>
<td>decimal</td>
<td>decimal</td>
</tr>
<tr>
<td>uri</td>
<td>uri</td>
</tr>
<tr>
<td>base64Binary</td>
<td>base64Binary</td>
</tr>
<tr>
<td>instant</td>
<td>instant</td>
</tr>
<tr>
<td>date</td>
<td>date</td>
</tr>
<tr>
<td>dateTime</td>
<td>dateTime, date, instant</td>
</tr>
<tr>
<td>time</td>
<td>time</td>
</tr>
<tr>
<td>oid</td>
<td>oid</td>
</tr>
<tr>
<td>id</td>
<td>id</td>
</tr>
<tr>
<td>markdown</td>
<td>markdown, string</td>
</tr>
<tr>
<td>unsignedInt</td>
<td>unsignedInt, integer, Quantity</td>
</tr>
<tr>
<td>positiveInt</td>
<td>positiveInt, unsignedInt, integer, Quantity</td>
</tr>
<tr>
<td>xtml</td>
<td>xtml</td>
</tr>
</tbody>
</table>
<h3 id="map-file-example">Map File Example</h3>
<pre><code>Grammar:    Map 5.1
Namespace:  obf
Target:     FHIR_STU_3

Dosage maps to Dosage:
    DoseSequenceNumber maps to sequence
    InstructionText maps to text
    InstructionCode maps to additionalInstruction
    PatientInstruction maps to patientInstruction
    Timing maps to timing
    AsNeeded maps to asNeeded[x]
    AdministrationSite maps to site
    RouteIntoBody maps to route
    Method maps to method
    DoseAndRate.DoseAmount maps to dose[x]
    DoseAndRate.DoseRate maps to rate[x]
    MaxDosePerPeriod maps to maxDosePerPeriod
    MaxDosePerAdministration maps to maxDosePerAdministration
    MaxDosePerLifetime maps to maxDosePerLifetime

MedicationStatement maps to http://hl7.org/fhir/us/core/StructureDefinition/us-core-medicationstatement:
    Identifier maps to identifier
    MedicationBasedOn maps to basedOn
    MedicationStatementPartOf maps to partOf
    CareContext maps to context
    Status maps to status
    StatusReason maps to extension
    Category maps to category
    MedicationCodeOrReference maps to medication[x]
    OccurrenceTimeOrPeriod maps to effective[x]
    StatementDateTime maps to dateAsserted
    MedicationInformationSource maps to informationSource
    SubjectOfRecord maps to subject
    SupportingInformation maps to derivedFrom
    fix taken to #y
    constrain reasonNotTaken to 0..0
    constrain dosage to 0..1
    ReasonCode maps to reasonCode
    MedicationReasonReference maps to reasonReference
    Annotation maps to note
    Dosage maps to dosage
</code></pre>

<h3 id="map-file-header">Map File Header</h3>
<p>The header of a map file must include a <code>Grammar</code>, <code>Namespace</code>, and <code>Target</code> keywords. The Target keyword gives the version of FHIR that the CIMPL model is mapped to, either <code>FHIR_DSTU_2</code>, <code>FHIR_STU_3</code>, or <code>FHIR_R4</code>.</p>
<p>For a further description of the header keywords, see <a href="#keywords">Keywords</a>.</p>
<h3 id="setting-the-mapping-target">Setting the Mapping Target</h3>
<p>Each block in a mapping file begins with a statement that establishes a resource, profile, or complex data type that is the target for the mapping. In CIMPL map files, the item to the left of <code>maps to</code> comes from your CIMPL data model and the item to the right is an element in the target output. The mapping target can be a FHIR resource or profile that is part of the target FHIR release version. The initial statement in each mapping block must end with a colon (:).</p>
<table>
<thead>
<tr>
<th>CIMPL Building Block</th>
<th>FHIR Target</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Entry</td>
<td>Resource</td>
<td><code>SocialHistoryObservation maps to Observation:</code></td>
</tr>
<tr>
<td>Entry</td>
<td>Profile</td>
<td><code>LaboratoryObservation maps to http://hl7.org/fhir/us/core/StructureDefinition/us-core-observationresults:</code></td>
</tr>
<tr>
<td>Group</td>
<td>Complex Datatype</td>
<td><code>Timing maps to Timing:</code></td>
</tr>
</tbody>
</table>
<h3 id="mapping-properties">Mapping Properties</h3>
<p>After the first line, the remainder of the block consists of statements that map CIMPL properties to FHIR elements. Each statement begins with a <a href="#cimpl-paths">CIMPL path</a>, followed by the phrase <code>maps to</code>, and ending with the target FHIR path.</p>
<p>With FHIR as the target output, the right-hand side of the map statement can point to any field on a FHIR resource, including:</p>
<ul>
<li>Fields that are at the root of the resource (e.g., <code>maritalStatus</code>)</li>
<li>Fields that are child elements of root elements on the resource (e.g., <code>reaction.substance</code>)</li>
<li>Fields that have a <a href="https://www.hl7.org/fhir/formats.html#choice">choice of data types</a> (e.g., <code>multipleBirth[x].boolean</code>)</li>
<li>Fields that have been defined in existing profiles or other <code>StructureDefinition</code> resources (e.g., <code>http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity</code>)</li>
<li>Fields that support FHIR Reference() types.</li>
</ul>
<table>
<thead>
<tr>
<th>CIMPL type</th>
<th>FHIR type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Property</td>
<td>element</td>
<td><code>MaritalStatus maps to maritalStatus</code></td>
</tr>
<tr>
<td>Property</td>
<td>extension</td>
<td><code>Ethnicity maps to http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity</code></td>
</tr>
<tr>
<td>Path</td>
<td>element</td>
<td><code>Value.ActiveFlag maps to active</code></td>
</tr>
<tr>
<td>Path</td>
<td>path</td>
<td><code>AdverseReaction.AllergenIrritant maps to reaction.substance</code></td>
</tr>
<tr>
<td>Value choice</td>
<td>element</td>
<td><code>BodySiteOrCode.concept maps to bodySite</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> The mapping grammar is still at version 5.1, so the bracketed value syntax cannot be used in paths.  This is why the above example uses <code>BodySiteOrCode.concept</code> rather than <code>BodySiteOrCode[concept]</code>.</p>
</blockquote>
<h3 id="mapping-to-references">Mapping to References</h3>
<p>FHIR resources and profiles require an explicit <code>Reference()</code> indicator when referring to another resource or profile. In CIMPL, whenever a property is an Entry, that property is mapped as a reference in FHIR. There is no need to create an explicit <code>Reference()</code>.</p>
<p>Example:</p>
<table>
<thead>
<tr>
<th>CIMPL Definition</th>
<th>Corresponding FHIR</th>
</tr>
</thead>
<tbody>
<tr>
<td>Property:  Encounter 0..1</td>
<td>encounter:    0..1  Reference(Encounter)</td>
</tr>
</tbody>
</table>
<h3 id="placement-of-extensions">Placement of Extensions</h3>
<p>As mentioned above, if no mapping rule is found for a property, an extension will be automatically created. By default, the extension will be a top-level element in the FHIR profile. Sometimes you may want the extension to appear in a different place, perhaps inside a nested element. To put the extension precisely where you want it, you can map to FHIR paths that include <code>extension</code>.</p>
<p>Here's an example involving AdverseEvent:</p>
<p><code>PotentialCause.CauseCategory maps to suspectEntity.extension</code></p>
<p>This rule will create an extension named <code>CauseCategory</code> under AdverseEvent.suspectEntity. Note that rules such as this:</p>
<p><code>DetectionTime maps to extension</code></p>
<p>leave the default behavior unchanged, and are not required. However, they can be used to document the intent to create an extension.</p>
<h3 id="special-mapping-statements">Special Mapping Statements</h3>
<h4 id="fix">fix</h4>
<p><code>fix</code> allows FHIR fields to be assigned a value. Note that it is the FHIR resource that is getting the value, not the CIMPL class. This enables you to fix a FHIR value without having to change the class definition, which would affect all potential mappings. This also allows you to fix FHIR values for properties that have no corresponding property in the CIMPL definition.</p>
<p>Example:</p>
<p><code>fix status to #completed</code></p>
<h4 id="constrain">constrain</h4>
<p><code>constrain</code> allows users to constrain the cardinality of FHIR elements. Note that it is the FHIR resource that is getting the constraint, not the CIMPL class. The cardinality is expressed in {min}..{max} form.</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>constrain</code></td>
<td><code>constrain explanation to 0..1</code></td>
</tr>
</tbody>
</table>
<h3 id="slicing">Slicing</h3>
<p>When fields are allowed to repeat on a target model (e.g., have cardinality with an upper bound greater than 1), it is common practice to specify which CIMPL elements are mapped to instances of that repeated field on the target model.  This process is called <strong>slicing</strong>. For example, the <a href="https://www.hl7.org/fhir/task.html">FHIR Task resource</a> allows for an arbitrary number of <code>input</code> fields to be added.  To ensure that each <code>input</code> field is uniquely addressable by a parsing engine, those inputs need to be differentiated by a <strong>discriminator</strong>.</p>
<p>See the FHIR documentation for more detail about <a href="https://www.hl7.org/fhir/profiling.html#slicing">slicing</a> and <a href="https://www.hl7.org/fhir/profiling.html#discriminator">discriminators</a>.</p>
<h4 id="slicing-rules">Slicing Rules</h4>
<p>Slicing is used when there is a variation of how an individual element is represented and a need to model it as a sub-list.  An example of this is the <a href="https://www.hl7.org/fhir/profiling.html#slicing">FHIR Blood Pressure profile</a>, which can be considered an observation with two components which are identical in structure other than their represented code.</p>
<p>In CIMPL, slicing rules are specified in the map file.  Four reserved phrases are used in conjunction to specify the slice:</p>
<ul>
<li><code>slice on</code> (required)</li>
<li><code>slice on type</code> (optional)</li>
<li><code>slice strategy</code> (optional)</li>
<li><code>slice at</code> (optional)</li>
</ul>
<p>Examples of their usage in a statement are shown below:</p>
<table>
<thead>
<tr>
<th align="left">Phrase</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>slice on</code> / <code>slice strategy</code></td>
<td align="left">Components.ObservationComponent maps to component <code>(slice on = code.coding.code; slice strategy = includes)</code></td>
</tr>
<tr>
<td align="left"><code>slice on</code> / <code>slice strategy</code></td>
<td align="left">Members.Observation maps to related.target <code>(slice at = related; slice on = target.reference.resolve(); slice on type = profile; slice strategy = includes)</code></td>
</tr>
<tr>
<td align="left"><code>slice on</code></td>
<td align="left"><code>Laterality maps to qualifier (slice on = concept)</code></td>
</tr>
</tbody>
</table>
<h4 id="declaring-a-discriminator">Declaring a Discriminator</h4>
<p>Discriminators are used to indicate how each slice can be distinguished from the others. FHIR requires discriminators to uniquely identify the slice to which an instance of data belongs.</p>
<p>To perform any slicing, a discriminator path needs to be declared, using <code>slice on</code> followed by the discriminator path.  This is the path to the property whose data identifies the slice in which an instance belongs.</p>
<p>FHIR also requires a discriminator type to be indicated.  By default, CIMPL will use the <code>value</code> discriminator type, but a different discriminator type can be declared using <code>slice on type</code> followed by one of the following FHIR-defined discriminator types:</p>
<table>
<thead>
<tr>
<th>Discriminator Type</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>The slices have different values in the nominated element</td>
</tr>
<tr>
<td>exists</td>
<td>The slices are differentiated by the presence or absence of the nominated element</td>
</tr>
<tr>
<td>pattern</td>
<td>The slices have different values in the nominated element, as determined by testing them against the applicable ElementDefinition.pattern[x]</td>
</tr>
<tr>
<td>type</td>
<td>The slices are differentiated by type of the nominated element to a specified profile</td>
</tr>
<tr>
<td>profile</td>
<td>The slices are differentiated by conformance of the nominated element to a specified profile (not recommended)</td>
</tr>
</tbody>
</table>
<h4 id="slice-strategy">Slice Strategy</h4>
<p>The <code>slice_strategy</code> indicates how the CIMPL property should map to slices in the target FHIR property. The default <code>slice strategy</code> adds a single slice, corresponding to the CIMPL type, in the target FHIR array.  To map a CIMPL property with <code>includes</code> constraints such that each included CIMPL type becomes a slice in the target FHIR array, specify <code>slice strategy = includes</code>.</p>
<table>
<thead>
<tr>
<th>Reserved Phrase</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slice strategy</code></td>
<td><code>Components.ObservationComponent maps to component (slice on = code.coding.code; slice strategy = includes)</code></td>
</tr>
</tbody>
</table>
<p>In the above example, each included <code>ObservationComponent</code> subtype will create a new slice in the FHIR <code>component</code> array.  Each slice is distinguished by the value at the path <code>component.code.coding.code</code>.</p>
<h4 id="moving-the-slice-location">Moving the Slice Location</h4>
<p>If the discriminator used for slicing is not the actual field that is being mapped to, <code>slice at</code> can allow you to explicitly define the location of the slice.</p>
<table>
<thead>
<tr>
<th>Reserved Phrase</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slice at</code></td>
<td><code>Members.Observation maps to related.target (slice at = related; slice on = type)</code></td>
</tr>
</tbody>
</table>
<p>In the above example, though the mapping is declared such that <code>Members.Observation maps to related.target</code>, the slicing is not occurring at <code>related.target</code>.  Instead, the <code>slice at = related</code> ensures that the slicing is occurring at the <code>related</code> element.</p>
<hr />
<h2 id="appendix-a-changes-from-cimpl-5x">Appendix A: Changes from CIMPL 5.x</h2>
<p>For those who have created detailed models using CIMPL 5.0, there have been significant grammar changes to CIMPL 6.0. The table below summarizes these changes:</p>
<table>
<thead>
<tr>
<th align="left">Change Type</th>
<th align="left">Change Description</th>
<th align="left">CIMPL 5.0 Example</th>
<th align="left">CIMPL 6.0 Example</th>
<th align="left">Section</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">New</td>
<td align="left">keyword <code>only</code> eliminates all value choices except one</td>
<td align="left">None</td>
<td align="left"><code>FindingResult only concept</code></td>
<td align="left"><a href="#only-constraint">Only Constraint</a></td>
</tr>
<tr>
<td align="left">New</td>
<td align="left">keyword <code>Property</code> is required to define properties for an Entry or Element.</td>
<td align="left"><code>0..1 TreatmentIntent</code></td>
<td align="left"><code>Property:  TreatmentIntent 0..1</code></td>
<td align="left"><a href="#property">Property Keyword</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>EntryElement</code> keyword replaced by <code>Entry</code></td>
<td align="left"><code>EntryElement: CourseOfTreatmentPerformed</code></td>
<td align="left"><code>Entry:  CourseOfTreatmentPerformed</code></td>
<td align="left"><a href="#element">Element Keyword</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>Based on</code> keyword replaced by <code>Parent</code></td>
<td align="left"><code>Based on: Observation</code></td>
<td align="left"><code>Parent:  Observation</code></td>
<td align="left"><a href="#parent">Parent Keyword</a></td>
</tr>
<tr>
<td align="left">Syntax change</td>
<td align="left">Cardinality is specified <em>after</em> the property or class name</td>
<td align="left"><code>0..1 TreatmentIntent</code></td>
<td align="left"><code>Property:  TreatmentIntent 0..1</code></td>
<td align="left"><a href="#property">Property Keyword</a>, <a href="#cardinality-constraint">Cardinality Constraint</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>is</code> constraint for fixed values replaced by <code>=</code></td>
<td align="left"><code>FindingTopicCode is LNC#48676-1</code></td>
<td align="left"><code>FindingTopicCode = LNC#48676-1</code></td>
<td align="left"><a href="#field-constraints">Field Constraints</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left">substitution of a more specific element derived from a parent element using <code>is type</code> keyword replaced by <code>substitute</code>.</td>
<td align="left"><code>Specimen is type BreastSpecimen</code></td>
<td align="left"><code>Specimen substitute BreastSpecimen</code></td>
<td align="left"><a href="#substitute">Substitute</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>code</code>, <code>Coding</code>, and <code>CodeableConcept</code> are replaced by a new primitive <code>concept</code></td>
<td align="left"><code>Value: CodeableConcept from AttributionCategoryVS</code></td>
<td align="left"><code>Value: concept from AttributionCategoryVS</code></td>
<td align="left"><a href="#primitives">Primitives</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>must be</code>, <code>should be</code>, <code>could be</code>, and <code>if covered</code> value set constraints are obsolete and replaced by <code>(required)</code>, <code>(preferred)</code>, <code>(extensible)</code>, and <code>(example)</code></td>
<td align="left"><code>Type from BreastSpecimenTypeVS if covered</code></td>
<td align="left"><code>Type from BreastSpecimenTypeVS (extensible)</code></td>
<td align="left"><a href="#value-set-binding-constraint">Value Set Binding Constraint</a></td>
</tr>
<tr>
<td align="left">Replace</td>
<td align="left"><code>ref()</code> is now obsolete. <code>value is type</code> replaced by <code>substitute</code> and bracket notation denoting value choices</td>
<td align="left"><code>SourceSpecimen value is type ref(BreastSpecimen)</code></td>
<td align="left"><code>SourceSpecimen[Specimen] substitute BreastSpecimen</code></td>
<td align="left"><a href="#mapping-to-references">Mapping to References</a></td>
</tr>
</tbody>
</table></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>© 2019 The MITRE Corporation. All rights reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
